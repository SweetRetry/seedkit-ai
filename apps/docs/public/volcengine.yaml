openapi: 3.1.0
info:
  title: Volcengine Ark API
  description: 火山引擎方舟大模型服务 API，包含对话、响应、图像生成和视频生成接口。
  version: 1.0.0
  contact:
    name: Volcengine Ark
    url: https://www.volcengine.com/docs/82379

servers:
  - url: https://ark.cn-beijing.volces.com/api/v3
    description: 火山引擎方舟 API（北京）

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: 使用 ARK_API_KEY 进行认证

  schemas:
    ChatMessage:
      type: object
      required: [role, content]
      properties:
        role:
          type: string
          enum: [system, user, assistant]
          description: 消息角色
        content:
          oneOf:
            - type: string
              description: 纯文本内容
            - type: array
              description: 多模态内容列表
              items:
                type: object

    ChatCompletionRequest:
      type: object
      required: [model, messages]
      properties:
        model:
          type: string
          description: 模型 ID，如 doubao-seed-1-6-251015
          example: doubao-seed-1-6-251015
        messages:
          type: array
          items:
            $ref: '#/components/schemas/ChatMessage'
        stream:
          type: boolean
          default: false
          description: 是否开启流式输出
        temperature:
          type: number
          minimum: 0
          maximum: 2
          default: 1
          description: 采样温度
        top_p:
          type: number
          minimum: 0
          maximum: 1
          default: 0.7
          description: 核采样阈值
        max_tokens:
          type: integer
          default: 4096
          description: 最大回答 token 数（不含思维链），不可与 max_completion_tokens 同时设置
        max_completion_tokens:
          type: integer
          description: 最大总 token 数（回答 + 思维链），不可与 max_tokens 同时设置
        thinking:
          type: object
          properties:
            type:
              type: string
              enum: [enabled, disabled]
          description: 深度思考模式控制
        response_format:
          type: object
          description: 输出格式控制（json_schema / json_object）
        tools:
          type: array
          items:
            type: object
          description: Function Calling 工具定义

    ChatCompletionResponse:
      type: object
      properties:
        id:
          type: string
          description: 响应唯一 ID
        object:
          type: string
          example: chat.completion
        created:
          type: integer
          description: 创建时间（Unix 时间戳）
        model:
          type: string
        choices:
          type: array
          items:
            type: object
            properties:
              index:
                type: integer
              message:
                $ref: '#/components/schemas/ChatMessage'
              finish_reason:
                type: string
                enum: [stop, length, tool_calls]
        usage:
          type: object
          properties:
            prompt_tokens:
              type: integer
            completion_tokens:
              type: integer
            total_tokens:
              type: integer

    ResponsesRequest:
      type: object
      required: [model, input]
      properties:
        model:
          type: string
          description: 模型 ID
          example: doubao-seed-1-6-251015
        input:
          oneOf:
            - type: string
              description: 简写纯文本输入
            - type: array
              description: 消息数组
              items:
                type: object
        instructions:
          type: string
          description: 系统/开发者指令
        stream:
          type: boolean
          default: false
        temperature:
          type: number
          minimum: 0
          maximum: 2
          default: 1
        top_p:
          type: number
          minimum: 0
          maximum: 1
          default: 0.7
        max_output_tokens:
          type: integer
          description: 最大输出 token 数（含思维链）
        thinking:
          type: object
          properties:
            type:
              type: string
              enum: [enabled, disabled, auto]
        reasoning:
          type: object
          properties:
            effort:
              type: string
              enum: [minimal, low, medium, high]
              default: medium
        text:
          type: object
          description: 输出格式控制
        tools:
          type: array
          items:
            type: object
        tool_choice:
          oneOf:
            - type: string
              enum: [auto, none, required]
            - type: object
        max_tool_calls:
          type: integer
          minimum: 1
          maximum: 10

    ResponsesResponse:
      type: object
      properties:
        id:
          type: string
          description: 响应唯一 ID
        status:
          type: string
          enum: [completed, incomplete, failed]
        output:
          type: array
          items:
            type: object
        usage:
          type: object
          properties:
            input_tokens:
              type: integer
            output_tokens:
              type: integer
            total_tokens:
              type: integer

    ImageGenerationRequest:
      type: object
      required: [model, prompt]
      properties:
        model:
          type: string
          description: 模型 ID
          example: doubao-seedream-5-0-260128
          enum:
            - doubao-seedream-5-0-260128
            - doubao-seedream-5-0-lite-260128
            - doubao-seedream-4-5-251128
            - doubao-seedream-4-0-250828
        prompt:
          type: string
          description: 图像生成提示词
        image:
          oneOf:
            - type: string
              description: 单张参考图 URL 或 Base64
            - type: array
              items:
                type: string
              description: 多张参考图
        size:
          type: string
          description: 图像尺寸，支持档位（1K/2K/3K/4K）或具体像素（如 2048x2048）
          example: 2K
        response_format:
          type: string
          enum: [url, b64_json]
          default: url
        output_format:
          type: string
          enum: [png, jpeg]
          description: 输出文件格式（Seedream 5.0 lite 支持 png/jpeg，其余固定为 jpeg）
        watermark:
          type: boolean
          default: false
          description: 是否添加水印
        stream:
          type: boolean
          default: false
          description: 是否流式返回（每张完成后立即推送）
        sequential_image_generation:
          type: string
          enum: [auto, disabled]
          description: 组图生成模式
        optimize_prompt_options:
          type: object
          properties:
            mode:
              type: string
              enum: [standard, fast]
        tools:
          type: array
          items:
            type: object
          description: 工具列表，目前支持 web_search

    ImageGenerationResponse:
      type: object
      properties:
        created:
          type: integer
          description: 创建时间（Unix 时间戳）
        data:
          type: array
          items:
            type: object
            properties:
              url:
                type: string
                description: 图片下载链接（response_format=url 时返回）
              b64_json:
                type: string
                description: Base64 编码图片（response_format=b64_json 时返回）

    VideoTaskRequest:
      type: object
      required: [model, content]
      properties:
        model:
          type: string
          description: 模型 ID
          example: doubao-seedance-1-5-pro-251215
          enum:
            - doubao-seedance-1-5-pro-251215
            - doubao-seedance-1-0-pro-250528
            - doubao-seedance-1-0-pro-fast-251015
            - doubao-seedance-1-0-lite-t2v-250428
            - doubao-seedance-1-0-lite-i2v-250428
        content:
          type: array
          description: 输入内容（文本 + 图片可组合）
          items:
            type: object
            required: [type]
            properties:
              type:
                type: string
                enum: [text, image_url]
              text:
                type: string
                description: 提示词（type=text 时必填）
              image_url:
                type: object
                properties:
                  url:
                    type: string
                    description: 图片 URL 或 Base64
              role:
                type: string
                enum: [first_frame, last_frame, reference_image]
                description: 图片角色（多图时必填）
        return_last_frame:
          type: boolean
          default: false
          description: 是否返回生成视频的尾帧
        generate_audio:
          type: boolean
          default: true
          description: 是否生成同步音频（仅 Seedance 1.5 pro）
        resolution:
          type: string
          enum: [480p, 720p, 1080p]
          description: 输出分辨率
        ratio:
          type: string
          enum: ["16:9", "4:3", "1:1", "3:4", "9:16", "21:9", adaptive]
          description: 输出宽高比
        duration:
          type: integer
          minimum: 2
          maximum: 12
          default: 5
          description: 视频时长（秒），与 frames 互斥
        frames:
          type: integer
          description: 视频帧数（精确控制时长），与 duration 互斥
        seed:
          type: integer
          minimum: -1
          default: -1
          description: 随机种子
        camera_fixed:
          type: boolean
          default: false
          description: 是否固定摄像头
        watermark:
          type: boolean
          default: false
          description: 是否添加水印

    VideoTaskResponse:
      type: object
      properties:
        id:
          type: string
          description: 任务 ID，保存 7 天

    VideoTaskStatus:
      type: object
      properties:
        id:
          type: string
        model:
          type: string
        status:
          type: string
          enum: [queued, running, succeeded, failed, cancelled, expired]
        error:
          type: object
          nullable: true
          properties:
            code:
              type: string
            message:
              type: string
        content:
          type: object
          properties:
            video_url:
              type: string
              description: 视频下载地址（mp4），有效期 24 小时
            last_frame_url:
              type: string
              description: 视频尾帧图像地址，有效期 24 小时
        created_at:
          type: integer
        updated_at:
          type: integer
        seed:
          type: integer
        resolution:
          type: string
        ratio:
          type: string
        duration:
          type: integer
        frames:
          type: integer
        framespersecond:
          type: integer
        generate_audio:
          type: boolean
        usage:
          type: object
          properties:
            completion_tokens:
              type: integer
            total_tokens:
              type: integer

paths:
  /chat/completions:
    post:
      operationId: createChatCompletion
      summary: 创建对话补全
      description: 基于消息列表生成模型回复，支持流式输出、多模态输入、Function Calling 和结构化输出。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatCompletionRequest'
            examples:
              text:
                summary: 文本生成
                value:
                  model: doubao-seed-1-6-251015
                  messages:
                    - role: user
                      content: 常见的十字花科植物有哪些？
              stream:
                summary: 流式输出
                value:
                  model: doubao-seed-1-6-251015
                  messages:
                    - role: user
                      content: 常见的十字花科植物有哪些？
                  stream: true
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatCompletionResponse'

  /responses:
    post:
      operationId: createResponse
      summary: 创建响应（Responses API）
      description: 新一代对话接口，支持多轮会话管理、联网搜索、深度思考、结构化输出等能力。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResponsesRequest'
            examples:
              text:
                summary: 文本生成
                value:
                  model: doubao-seed-1-6-251015
                  input: 你好，介绍一下自己
              thinking:
                summary: 深度思考
                value:
                  model: doubao-seed-1-6-251015
                  input: 推理模型与非推理模型的区别
                  thinking:
                    type: enabled
                  reasoning:
                    effort: high
                  stream: true
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponsesResponse'

  /responses/{response_id}:
    get:
      operationId: getResponse
      summary: 查询响应
      description: 查询已完成的响应对象。
      parameters:
        - name: response_id
          in: path
          required: true
          schema:
            type: string
          description: 响应 ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponsesResponse'

  /images/generations:
    post:
      operationId: createImage
      summary: 图像生成
      description: 基于文本提示词生成图像，支持文生图、图生图、多图融合和组图输出。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImageGenerationRequest'
            examples:
              text_to_image:
                summary: 文生图
                value:
                  model: doubao-seedream-5-0-260128
                  prompt: 充满活力的特写编辑肖像，模特眼神犀利，头戴雕塑感帽子
                  size: 2K
                  output_format: png
                  watermark: false
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageGenerationResponse'

  /contents/generations/tasks:
    post:
      operationId: createVideoTask
      summary: 创建视频生成任务
      description: 异步创建视频生成任务，返回任务 ID 后需轮询查询状态。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VideoTaskRequest'
            examples:
              text_to_video:
                summary: 文生视频
                value:
                  model: doubao-seedance-1-5-pro-251215
                  content:
                    - type: text
                      text: 小猫对着镜头打哈欠
                  resolution: 720p
                  ratio: "16:9"
                  duration: 5
                  watermark: false
      responses:
        '200':
          description: 任务创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoTaskResponse'

  /contents/generations/tasks/{id}:
    get:
      operationId: getVideoTask
      summary: 查询视频生成任务
      description: 查询指定任务的状态，status 为 succeeded 时可从 content.video_url 下载视频。
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: 任务 ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoTaskStatus'
